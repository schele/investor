@using System.Web.Script.Serialization
@using Investor.Models.Models
@using Investor.Models.PageModels
@using umbraco.NodeFactory
@inherits Umbraco.Web.Mvc.UmbracoTemplatePage
@inherits UmbracoViewPage<StartPageModel>

@{
	Layout = "Master.cshtml";

    var serializer = new JavaScriptSerializer();
}

<div>
    @foreach (var id in Umbraco.Field("slideshow").ToString().Split(','))
    {
        var media = ApplicationContext.Current.Services.MediaService.GetById(int.Parse(id));
        var heading = media.Properties.FirstOrDefault(x => x.Alias == "heading");
        var text = media.Properties.FirstOrDefault(x => x.Alias == "text");
        var url = media.Properties.FirstOrDefault(x => x.Alias == "url");
        var urlText = media.Properties.FirstOrDefault(x => x.Alias == "urlText");        
        var umbracoFile = media.Properties.FirstOrDefault(x => x.Alias == "umbracoFile");
        
        var slideshowHeading = string.Empty;
        var slideshowText = string.Empty;
        var destination = new Node();
        var destinationText = string.Empty;
        var image = new Slideshow();

        if (heading != null)
        {
            slideshowHeading = heading.Value.ToString();
        }

        if (text != null)
        {
            slideshowText = text.Value.ToString();
        }

        if (url != null && url.Value != null)
        {
            destination = new Node(int.Parse(url.Value.ToString()));
            
        }
        
        if (urlText != null && urlText.Value != null)
        {
            destinationText = urlText.Value.ToString();            
        }
        
        if (umbracoFile != null && umbracoFile.Value != null)
        {
            image = serializer.Deserialize<Slideshow>(umbracoFile.Value.ToString());
        }

        <h2>@slideshowHeading</h2>
        <p>@slideshowText</p>
        <a href="@destination.NiceUrl">@destinationText</a>
        <img src="@image.Src" alt="@slideshowHeading" />
    }
</div>