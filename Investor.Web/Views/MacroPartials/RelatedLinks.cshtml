@using System.Web.Script.Serialization
@using Investor.Helpers
@using Investor.Models.Models.NodeLink
@using Umbraco.Web.Macros

@inherits PartialViewMacroPage

@{
    var heading = Model.MacroParameters["Heading"].ToString();
    var headingUrl = Model.MacroParameters["HeadingUrl"].ToString();
    var relatedLinks = Model.MacroParameters["RelatedLinks"].ToString().Replace("&quot;", "\"");
    var links = new JavaScriptSerializer().Deserialize<IEnumerable<NodeLink>>(relatedLinks);    
}

<div class="related-links">
    <div class="related-links-header">
        <h2>
            <a href="@Umbraco.TypedContent(headingUrl).Url">@heading</a>
        </h2>
    </div>
    <ul class="related-links-list">
        @foreach (var link in links)
        {
            var preamble = Umbraco.TypedContent(int.Parse(link.Link)).GetProperty("preamble").Value;
            <li>
                <a href="#">
                    @Html.Render(preamble, @<p>@preamble</p>)
                    @Html.Render(link.Caption, @<span>@link.Caption</span>)
                </a>
            </li>
        }
    </ul>
</div>