@using Investor.Helpers
@using Investor.Models.Extensions
@using Investor.Models.PageModels
@using MediaExtensions = Investor.Models.Extensions.MediaExtensions

@inherits UmbracoViewPage<ArticlePageModel>

@{
    Layout = "Master.cshtml";

    var docs = Model.RelatedDocuments.ToList();
}

<div class="row">
    @Html.Partial("~/Views/Partials/SubNavigation.cshtml")

    <article class="article-page col-md-9">
        <div class="row">
            <div class="article-page-content col-md-9">
                @Html.Render(Model.Header, @<h1 class="article-page-header">@Model.Header</h1>)
                @Html.Render(Model.Preamble, @<p class="article-page-premable">@Model.Preamble</p>)
                @Html.Render(Model.Text, @<div class="text-editor-content">@Html.Raw(Model.Text)</div>)
            </div>
            <div class="col-md-3">

                @if (Model.RelatedLinks != null)
                {
                    <div class="article-page-links">
                        <h3>
                            <span class="icon"></span>@Model.RelatedLinksHeader
                        </h3>
                        <ul>
                            @foreach (var link in Model.RelatedLinks.Take(5))
                            {
                                var target = link.NewWindow ? "_blank" : null;

                                <li><a href="@link.Link" target="@target" title="@link.Caption">@link.Caption</a></li>

                            }
                        </ul>
                        @if (Model.RelatedLinks.Count() > 5)
                        {

                            <ul class="article-page-links-expandable">
                                @foreach (var link in Model.RelatedLinks.Skip(5))
                                {
                                    var target = link.NewWindow ? "_blank" : null;

                                    <li><a href="@link.Link" target="@target" title="@link.Caption">@link.Caption</a></li>
                                }
                            </ul>
                            <button class="article-page-links-expand-btn">
                                <span class="article-page-links-expandable-closed active">Read more</span>
                                <span class="article-page-links-expandable-open">Read less</span>
                            </button> 
                        }
                    </div>
                }

                @if (docs[0] != null)
                {
                    <div class="article-page-documents">
                        <h3>
                            <span class="icon"></span>@Model.RelatedDocumentsHeader
                        </h3>
                        <ul>
                            @foreach (var document in Model.RelatedDocuments.Take(5))
                            {
                                if (document != null)
                                {
                                    var doc = MediaExtensions.GetMediaById(document.Id.ToString());

                                    <li><a href="@doc.FriendlyUrl()" title="@doc.Name">@Path.GetFileNameWithoutExtension(doc.Name)</a></li>
                                }
                            }
                        </ul>
                        @if (Model.RelatedDocuments.Count() > 5)
                        {
                            <ul class="article-page-documents-expandable">
                                @foreach (var document in Model.RelatedDocuments.Skip(5))
                                {
                                    if (document != null)
                                    {
                                        var doc = MediaExtensions.GetMediaById(document.Id.ToString());

                                        <li><a href="@doc.FriendlyUrl()" title="@doc.Name">@Path.GetFileNameWithoutExtension(doc.Name)</a></li>
                                    }
                                }
                            </ul>
                            <button class="article-page-documents-expand-btn">
                                <span class="article-page-documents-expandable-closed active">Read more</span>
                                <span class="article-page-documents-expandable-open">Read less</span>
                            </button>
                        }                
                    </div>
                }                
            </div>
        </div>
    </article>
</div>