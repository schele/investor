@using Investor.Helpers
@using Investor.Models.Extensions
@using Investor.Models.Models.NodeLink
@using Investor.Models.PageModels

@inherits UmbracoViewPage<ArticlePageModel>

@{
    Layout = "Master.cshtml";
}

@*@helper GetRelatedLink(NodeLink node)
{
    var target = node.NewWindow ? "_blank" : null;

    if (node.Type == "internal")
    {
        var rel = Umbraco.TypedContent(node.Link);
        <a href="@rel.Url" title="@node.Caption" target="@target">@node.Caption</a>
    }

    if (node.Type == "internalMedia")
    {
        var rel = Umbraco.TypedMedia(node.Link);
        <a href="@rel.Url" title="@node.Caption" target="@target">@node.Caption</a>
    }

    if (node.Type == "external")
    {
        <a href="@node.Link" title="@node.Caption" target="@target">@node.Caption</a>
    }
}*@

<div class="row">
    @Html.Partial("~/Views/Partials/SubNavigation.cshtml")

    <article class="article-page col-md-9">
        <div class="row">
            <div class="article-page-content col-md-9">
                @Html.Render(Model.Header, @<h1>@Model.Header</h1>)
                @Html.Render(Model.Preamble, @<p class="article-page-premable">@Model.Preamble</p>)
                @Html.Render(Model.Text, @<div class="text-editor-content">@Html.Raw(Model.Text)</div>)
            </div>
            <div class="col-md-3">
                @if (Model.RelatedLinks.Any())
                {
                    <div class="article-page-links">
                        <h3>
                            <span class="icon"></span>@Model.RelatedLinksHeader
                        </h3>
                        <ul>                            
                            @foreach (var item in Model.RelatedLinks.Take(5))
                            {
                                <li>@Html.RelatedLink(item)</li>
                            }
                        </ul>
                        @if (Model.RelatedLinks.Count() > 5)
                        {
                            <ul class="article-page-links-expandable">
                                @foreach (var link in Model.RelatedLinks.Skip(5))
                                {
                                    <li>
                                        @Html.RelatedLink(link)
                                        @*@GetRelatedLink(link)*@
                                    </li>
                                }
                            </ul>
                            <button class="article-page-links-expand-btn">
                                <span class="article-page-links-expandable-closed active">@Umbraco.GetDictionaryValue("System.Read.All")</span>
                                <span class="article-page-links-expandable-open">@Umbraco.GetDictionaryValue("System.Read.Less")</span>
                            </button>
                        }
                    </div>
                }

                @if (Model.RelatedDocuments.Any())
                {
                    <div class="article-page-documents">
                        <h3>
                            <span class="icon"></span>@Model.RelatedDocumentsHeader
                        </h3>
                        <ul>
                            @foreach (var item in Model.RelatedDocuments.Take(5))
                            {
                                <li>@Html.RelatedLink(item)</li>
                            }
                        </ul>
                        @if (Model.RelatedDocuments.Count() > 5)
                        {
                            <ul class="article-page-documents-expandable">
                                @foreach (var link in Model.RelatedDocuments.Skip(5))
                                {
                                    <li>@Html.RelatedLink(link)</li>
                                }
                            </ul>
                            <button class="article-page-documents-expand-btn">
                                <span class="article-page-documents-expandable-closed active">@Umbraco.GetDictionaryValue("System.Read.All")</span>
                                <span class="article-page-documents-expandable-open">@Umbraco.GetDictionaryValue("System.Read.Less")</span>
                            </button>
                        }                
                    </div>
                }
            </div>
        </div>
    </article>
</div>